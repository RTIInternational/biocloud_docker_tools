# Cell Viability PDF Parser

This Dockerfile sets up an environment for running an [Rscript](v1/parse_viability_pdf.R) that takes the PDF output from a cell viability assay run on the [ChemoMetec NucleoCounter NC-200](https://chemometec.com/nucleocounters/nc-200/) and exports a tab delimited file (1 row per sample).

## Overview

**Cell Viability**

Cell viability assays are used to measure the physical and physiological health of cells in response to extracellular stimuli, chemical agents, or therapeutic treatments, or when determining optimal growth conditions in cell culture.

For the Regenerative Medicine Innovation Project (RMIP), the In-Depth Cell Characterization Hub uses a NucleoCounter NC-200 to count the total number of viable versus dead cells in the sample. The output of this process is a standardized PDF file. 

The purpose of this docker is to run an Rscript that will take the PDF outputs generated by the IDCCH, extracts key values from the PDF and export a standardized, machine readable, tab-delimited output.

<br>

## Usage
The following command can be used to run the docker: 
```
docker pull rtibiocloud/pdf_parse_r:<tagname>
docker run -it rtibiocloud/pdf_parse_r:<tagname> -c "Rscript /opt/parser/parse_viability_pdf.R --help"
```

Example Docker run command with volume mounting:
```bash
docker run --rm -v ${PWD}:/data -w /data rtibiocloud/pdf_parse_r:<tagname> /bin/bash -c " Rscript /opt/parser/parse_viability_pdf.R -i /data/example.pdf -p /data -v"
```

If not running the docker from the directory with the data, replace `${PWD}` with the actual path on your host system with the PDF outputs.

<br>

## Build
To build this Docker image, you can use the following command:
```
docker build --rm -t rtibiocloud/pdf_parse_r:<tagname> -f Dockerfile .
```
Here's what each part of the command does:

`docker build`: This command tells Docker to build an image.
`--rm`: This flag removes any intermediate containers that are created during the build process, helping to keep your system clean.
`-t rtibiocloud/pdf_parse_r:v1.0.0`: The -t flag specifies the name and tag for the image. In this case, it's named pdf_parse_r with version v1.0.0.
`-f Dockerfile`: This flag specifies the Dockerfile to use for building the image. You can replace Dockerfile with the actual name of your Dockerfile if it's different.
`.`: The dot at the end of the command indicates that the build context is the current directory, where the Dockerfile is located.
Running this command will build a Docker image with the name `rtibiocloud/pdf_parse_r:v1.0.0`. Make sure you are in the directory containing the Dockerfile you want to use for building the image.

## Rscript Inputs
| Short Flag | Long Flag | Description |
|:-----:|:--------:|--------------------------------|
|   -i  |  --pdf       | Path to the input PDF file                 |
|   -p  |  --outpath   | Path to the output directory               |
|   -E  |  --excel     | Export the results as an MS Excel Workbook |
|   -v  |  --verbose   | Display verbose logging                    |
|   -h  |  --help      | Display the function usage statement       |

## Rscript Output
A tab-delimited file with 1 row and 14 columns
|     Column     | Description                                                                                           |
|:--------------:|-------------------------------------------------------------------------------------------------------|
|   Consortium   | The consortium, derived from the linker in the file name.                                             |
|     Project    | A 3-digit code that is assigned to the study by the IDCCH, derived from the linker in the file name.  |
|  Participant   | A unique deidentified identifier assigned to a participant by the RMIP investigator, derived from the linker in the file name.   |
| Discriminator  | An alphabetic character assigned to a particular biospecimen collection event, derived from the linker in the file name.         |
|   Identifier   | A numeric character assigned to a particular biospecimen collection event, derived from the linker in the file name.             |
|     Vial       | An alphabetic character assigned to a specific biospecimen collection aliquot, derived from the linker in the file name.         |
|     Date       | The date that the sample was processed.                                                               |
|   Viability    | The proportion of live cells in the sample, reported as a percentage.                                 |
|     Live       | The number of viable cells per milliliter of sample                                                   |
|     Dead       | The number of non-viable cells per milliliter of sample.                                              |
|     Total      | The total number of cells assessed per milliliter of sample.                                          |
|  Cell Diameter | The estimated cell diameter reported in units of micrometers.                                         |
|  Cell Diameter stdev  |The standard deviation observed in the cell diameter measurements.                              |
| pct aggregated |  The percentage of cells that occur in aggregates with five or more cells.                            |

## Perform a testrun
`docker run -v ${PWD}/example_files/:/data -t rtibiocloud/pdf_parse_r:v1.0.0 /bin/bash  -c "Rscript /opt/parser/parse_viability_pdf.R -i /data/example.pdf -p /data"`

<details>

```
Loading required package: getopt
Loading required package: dplyr

Attaching package: ‘dplyr’

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

Loading required package: pdftools
Using poppler version 22.12.0
[2024-02-03 03:27:51.597269] - main - INFO - User: root
[2024-02-03 03:27:51.601783] - main - INFO - Running from: 7592e68cb469
[2024-02-03 03:27:51.602141] - main - INFO - Platform: x86_64-pc-linux-gnu (64-bit)
[2024-02-03 03:27:51.608045] - main - INFO - R version: R version 4.3.2 (2023-10-31)
[2024-02-03 03:27:51.608333] - main - INFO - R packages loaded: pdftools, dplyr, getopt
[2024-02-03 03:27:51.612687] - main - INFO - Rscript: /opt/parser/parse_viability_pdf.R
[2024-02-03 03:27:51.613006] - getopt - INFO - CommandLine: -i /data/example.pdf -p /data -o example.tsv
[2024-02-03 03:27:51.61331] - getopt - INFO - Arguments: ARGS = character(0)
[2024-02-03 03:27:51.61331] - getopt - INFO - Arguments: pdf = /data/example.pdf
[2024-02-03 03:27:51.61331] - getopt - INFO - Arguments: outpath = /data
[2024-02-03 03:27:51.61331] - getopt - INFO - Arguments: outfile = example_harmonized.tsv
[2024-02-03 03:27:51.61331] - getopt - INFO - Arguments: excel = FALSE
[2024-02-03 03:27:51.61331] - getopt - INFO - Arguments: verbose = FALSE
[2024-02-03 03:27:51.624912] - load_pdf - INFO - Reading in the PDF file
[2024-02-03 03:27:51.629189] - load_pdf - INFO - PDF file /data/example.pdf processing complete
[2024-02-03 03:27:51.649153] - main - INFO - Process began at 2024-02-03 03:27:51.167343 and finished at 2024-02-03 03:27:51.649318
[2024-02-03 03:27:51.64963] - main - INFO - Finished
```

<br>

```
Outputs:
- Tab separated table:                      /data/example_harmonized.tsv
```
</details>

<br>

## Contact
For additional information or assistance, please contact Mike Enger (menger@rti.org).

#################################################################
